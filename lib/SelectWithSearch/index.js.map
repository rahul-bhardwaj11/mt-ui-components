{"version":3,"sources":["../../src/SelectWithSearch/index.js"],"names":["initialCache","options","hasMore","isLoading","SelectWithSyncSearch","props","Component","propTypes","PropTypes","arrayOf","object","SelectWithAsyncSearch","onMenuClose","setState","search","menuIsOpen","onMenuOpen","optionsCache","state","loadOptions","onInputChange","onMenuScrollToBottom","currentOptions","__loadOptions","prevOptions","promiseOption","pageSize","offset","length","then","resolve","initialOptionsCache","oldProps","cacheUniq","prevState","concat","func","any","number","defaultProps","SelectWithSearch","handleChange","selectedOption","showSelect","onSelect","value","async","style","SelectComponent","width","label","bool","placeholder","string"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Button from '../Button';\nimport Select, { SelectBase } from 'react-select';\nimport './index.scss';\n//import Icon from \"../Icon\";\nimport { Icon } from 'antd';\n\nconst initialCache = {\n  options: [],\n  hasMore: true,\n  isLoading: false\n};\n\nclass SelectWithSyncSearch extends Component {\n  static propTypes = {\n    options: PropTypes.arrayOf(PropTypes.object)\n  };\n  render() {\n    return <Select {...this.props} />;\n  }\n}\n\nclass SelectWithAsyncSearch extends Component {\n  static propTypes = {\n    promiseOption: PropTypes.func,\n    cacheUniq: PropTypes.any,\n    options: PropTypes.arrayOf(PropTypes.object),\n    pageSize: PropTypes.number\n  };\n\n  static defaultProps = {\n    cacheUniq: null,\n    options: null,\n    pageSize: 10\n  };\n\n  constructor(props) {\n    super(props);\n\n    const initialOptionsCache = props.options\n      ? {\n          '': {\n            isLoading: false,\n            options: props.options,\n            hasMore: true\n          }\n        }\n      : {};\n\n    this.state = {\n      search: '',\n      optionsCache: initialOptionsCache,\n      menuIsOpen: false\n    };\n  }\n\n  componentDidUpdate(oldProps) {\n    const { cacheUniq } = this.props;\n\n    if (oldProps.cacheUniq !== cacheUniq) {\n      this.setState({\n        optionsCache: {}\n      });\n    }\n  }\n\n  onMenuClose = () => {\n    this.setState({\n      search: '',\n      menuIsOpen: false\n    });\n  };\n\n  onMenuOpen = async () => {\n    await this.setState({\n      menuIsOpen: true\n    });\n\n    const { optionsCache } = this.state;\n\n    if (!optionsCache['']) {\n      await this.loadOptions();\n    }\n  };\n\n  onInputChange = async search => {\n    await this.setState({\n      search\n    });\n\n    const { optionsCache } = this.state;\n\n    if (!optionsCache[search]) {\n      await this.loadOptions();\n    }\n  };\n\n  onMenuScrollToBottom = async () => {\n    const { search, optionsCache } = this.state;\n\n    const currentOptions = optionsCache[search];\n\n    if (currentOptions) {\n      await this.loadOptions();\n    }\n  };\n\n  async loadOptions() {\n    const { search, optionsCache } = this.state;\n\n    const currentOptions = optionsCache[search] || initialCache;\n\n    if (currentOptions.isLoading || !currentOptions.hasMore) {\n      return;\n    }\n\n    await this.setState(prevState => ({\n      search,\n      optionsCache: {\n        ...prevState.optionsCache,\n        [search]: {\n          ...currentOptions,\n          isLoading: true\n        }\n      }\n    }));\n\n    try {\n      const loadOptions = this.__loadOptions;\n\n      const { options, hasMore } = await loadOptions(\n        search,\n        currentOptions.options\n      );\n\n      await this.setState(prevState => ({\n        optionsCache: {\n          ...prevState.optionsCache,\n          [search]: {\n            ...currentOptions,\n            options: currentOptions.options.concat(options),\n            hasMore: !!hasMore,\n            isLoading: false\n          }\n        }\n      }));\n    } catch (e) {\n      await this.setState(prevState => ({\n        optionsCache: {\n          ...prevState.optionsCache,\n          [search]: {\n            ...currentOptions,\n            isLoading: false\n          }\n        }\n      }));\n    }\n  }\n\n  __loadOptions = (search, prevOptions) => {\n    let { promiseOption, pageSize } = this.props;\n    return new Promise(resolve => {\n      let offset = prevOptions.length;\n      promiseOption({ search, offset, pageSize }).then(options => {\n        resolve({ options, hasMore: true });\n      }, {});\n    });\n  };\n\n  render() {\n    const { search, optionsCache, menuIsOpen } = this.state;\n\n    const currentOptions = optionsCache[search] || initialCache;\n\n    return (\n      <SelectBase\n        {...this.props}\n        arrowRenderer={() => null}\n        classNamePrefix=\"react-select-container\"\n        inputValue={search}\n        menuIsOpen={menuIsOpen}\n        onMenuClose={this.onMenuClose}\n        onMenuOpen={this.onMenuOpen}\n        onInputChange={this.onInputChange}\n        onMenuScrollToBottom={this.onMenuScrollToBottom}\n        isLoading={currentOptions.isLoading}\n        options={currentOptions.options}\n      />\n    );\n  }\n}\n\nclass SelectWithSearch extends Component {\n  static propTypes = {\n    promiseOption: PropTypes.func,\n    async: PropTypes.bool,\n    cacheUniq: PropTypes.any,\n    selectedOption: PropTypes.object,\n    options: PropTypes.arrayOf(PropTypes.object),\n    placeholder: PropTypes.string,\n    pageSize: PropTypes.number,\n    style: PropTypes.object,\n    onSelect: PropTypes.func\n  };\n  static defaultProps = {\n    style: { width: 200 }\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      showSelect: false,\n      selectedOption: props.selectedOption\n    };\n  }\n\n  handleChange = selectedOption => {\n    this.setState({ selectedOption, showSelect: false });\n    this.props.onSelect(selectedOption.value);\n  };\n\n  render() {\n    let { async, style } = this.props;\n    let SelectComponent;\n    if (async) {\n      SelectComponent = SelectWithAsyncSearch;\n    } else {\n      SelectComponent = SelectWithSyncSearch;\n    }\n    let { showSelect, selectedOption } = this.state;\n    let { width } = style;\n    return (\n      <div style={style}>\n        <Button\n          type=\"default\"\n          style={{ width }}\n          onClick={() => {\n            this.setState({\n              showSelect: !showSelect\n            });\n          }}\n        >\n          {selectedOption.label}\n          <Icon type=\"down\" />\n        </Button>\n        {showSelect && (\n          <SelectComponent {...this.props} onChange={this.handleChange} />\n        )}\n      </div>\n    );\n  }\n}\n\nexport default SelectWithSearch;\n"]}